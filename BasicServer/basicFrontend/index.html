<!DOCTYPE html>
<html lang='en'>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <title>Test Site</title>
    <style>
      .left-pane{
        position: absolute;
        width: 50%;
        float: left;
        background-color: #f3f3f3;
      }
      .right-pane{
        position: absolute;
        width: 45%;
        top: 0;
        right: 0;
      }
    </style>
  </head>
  <body>
    <div class="left-pane">
      <h2>Add User</h2>
      <form onsubmit="event.preventDefault();">
          <label for="id">ID</label>
          <br>
          <input  id="id" type="text" name="id" value="">
          <br>
          <label for="name">Enter Name</label>
          <br>
        <input id="name" type="text" name="name" value="">
        <br>
        <label for="age">Enter age:</label>
        <br>
        <input id= "age" type="text" name="age" value="">
        <br>
        <button onclick="addUser()">Add User</button>
      </form>

      <h2>Find User</h2>
      <form onsubmit="event.preventDefault();">
          <label for="id">ID</label>
          <br>
          <input id="user" type="text" name="id" value="">
        <br>
        <button onclick="displayUser()">Find User</button>
      </form>

      <h2>Delete User</h2>
      <form onsubmit="event.preventDefault();">
          <label for="id">ID</label>
          <br>
          <input id="del" type="text" name="id" value="">
            <br>
        <button onclick="deleteUser()">Delete User</button>
      </form>

      <h2>Update User</h2>
      <form onsubmit="event.preventDefault();">
          <label for="id">ID</label>
          <br>
          <input id="new-id" type="text" name="id" value="">
          <br>
          <label for="name">Enter Name</label>
          <br>
        <input id="new-name" type="text" name="name" value="">
        <br>
        <label for="age">Enter age:</label>
        <br>
        <input id="new-age" type="text" name="age" value="">
        <br>
        <button onclick="updateUser()">Update User</button>
      </form>

      <h2>Edit User Infornation</h2>
      <form onsubmit="event.preventDefault();">
          <label for="id">ID</label>
          <br>
          <input id="user-id-choice" type="text" name="id" value="">
          <br>
          <label for="name">Select field</label>
          <br>
        <select id="choice" class="" name="field">
          <option value="name">name</option>
          <<option value="age">age</option>
        </select>
        <br>
        <label for="value">Enter preferred value:</label>
        <br>
        <input id="value" type="text" name="field" value="">
        <br>
        <button onclick="editUser()">Edit</button>
      </form>

      <h3>See all users</h3>
      <button onclick="displayUsers()">all users</button>
    </div>
    <div class="right-pane">
      <h1 style='margin:5%' >Results</h1>
    </div>

    <script type="text/javascript">
      const displayUsers = async () => {
            try {
                // Make GET request using axios
                let response = await axios.get('http://localhost:2000/users');

                // The data is already parsed as JSON in axios
                let users = response.data.users;
                let display = document.querySelector('.right-pane');

                // Clear previous content (if necessary)
                display.innerHTML = "<h1 style='margin:5%' >Results</h1>";

                // Append each user's information
                users.forEach((user) => {
                    display.innerHTML += `<p>id: ${user.id} name: ${user.name} age: ${user.age}</p>`;
                });
            } catch (error) {
                console.error('Error fetching users:', error);
            }
        }


        const displayUser = async () => {
          let id = document.getElementById('user').value;
          try {
              // Make GET request using axios
              let response = await axios.get(`http://localhost:2000/user?id=${id}`);

              // The data is already parsed as JSON in axios
              let user = response.data;
              let display = document.querySelector('.right-pane');

              // Preset content
              display.innerHTML = "<h1 style='margin:5%' >Results</h1>";

              // Append user's information
              display.innerHTML += `<p>id: ${user.id} name: ${user.name} age: ${user.age}</p>`;
          } catch (error) {
              console.error('Error fetching users:', error);
          }
        }

        const addUser = async () => {
          let id = document.getElementById('id').value;
          let name = document.getElementById('name').value;
          let age = document.getElementById('age').value;

          try {
                // Define the data to be sent in the request body
                const newUser = {
                    id: id,
                    name: name,
                    age: age
                };

                // Make the POST request
                const response = await axios.post('http://localhost:2000/add-user', newUser);


                let display = document.querySelector('.right-pane');
                // Preset content
                display.innerHTML = "<h1 style='margin:5%' >Results</h1>";

                // Append user's information
                display.innerHTML += `<p> user created </p>`;
            } catch (error) {
                // Preset content
                display.innerHTML = "<h1 style='margin:5%' >Results</h1>";

                // Append user's information
                display.innerHTML += `<p> Error </p>`;
            }
        }

        const updateUser = async () => {
            let id = document.getElementById('new-id').value;
            let name = document.getElementById('new-name').value;
            let age = document.getElementById('new-age').value;

            try {
                // Define the data to be sent in the request body
                const newUser = {
                    id: id,
                    name: name,
                    age: age
                };

                // Make the PUT request
                const response = await axios.put(`http://localhost:2000/update-user?id=${id}`, newUser);

                // Log the response
                console.log();


                let display = document.querySelector('.right-pane');
                // Preset content
                display.innerHTML = "<h1 style='margin:5%' >Results</h1>";

                // Append user's information
                display.innerHTML += `<p>'User updated:', ${response.data.message} </p>`;
            } catch (error) {
                console.error('Error updating user:', error);
            }
        }

        const editUser  = async () => {
          let id = document.getElementById('user-id-choice').value;
          let choice = document.getElementById('choice').value;
          let value = document.getElementById('value').value;

          try {
              // Define the data to be sent in the request body
              const field = {
                [choice]: value
              };

              console.log(field)
              // Make the PATCH request
              const response = await axios.patch(`http://localhost:2000/patch-user?id=${id}&field=${choice}`, field);

              // Log the response
              console.log();


              let display = document.querySelector('.right-pane');
              // Preset content
              display.innerHTML = "<h1 style='margin:5%' >Results</h1>";

              // Append user's information
              display.innerHTML += `<p>'User data edited:', ${response.data.message} </p>`;
          } catch (error) {
              console.error('Error editing user:', error);
        }
      }

        const deleteUser = async  () => {
          let id = document.getElementById('del').value;
          try {
              // Make GET request using axios
              let response = await axios.delete(`http://localhost:2000/user?id=${id}`);

              // The data is already parsed as JSON in axios
              let user = response.data.message;
              console.log(user)
              let display = document.querySelector('.right-pane');

              // Preset content
              display.innerHTML = "<h1 style='margin:5%' >Results</h1>";

              // Append user's information
              display.innerHTML += `<p>${user}</p>`;
          } catch (error) {
              console.error('Error fetching users:', error);
          }
        }
    </script>
  </body>
</html>
